{% extends "base.html" %}

{% block title %}Activity Log - AI Activity Planner{% endblock %}

{% block content %}
<h1>Activity Log</h1>

<div class="card">
    <h2>Account Connections</h2>
    <p style="margin-bottom: 1rem;">Connect your accounts to enhance your activity planning:</p>
    
    <div style="margin-bottom: 1rem;">
        {% if not current_user.google_id %}
        <a href="{{ url_for('integrations.connect_google') }}" class="btn" style="background: #4285f4; color: white; display: inline-flex; align-items: center; gap: 0.5rem; text-decoration: none;">
            <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
                <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
                <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
                <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
                <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
                <path fill="none" d="M0 0h48v48H0z"/>
            </svg>
            Connect Google Account
        </a>
        {% else %}
        <div style="display: inline-flex; align-items: center; gap: 0.5rem;">
            <button class="btn btn-primary" disabled>✓ Google Connected</button>
            <form method="POST" action="{{ url_for('integrations.disconnect_google') }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to disconnect your Google account?');">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <button type="submit" class="btn" style="background: #dc3545; color: white;">Disconnect</button>
            </form>
        </div>
        {% endif %}
    </div>
    
    <div style="margin-top: 1rem;">
        <h3 style="font-size: 1.1rem; margin-bottom: 0.5rem;">Fitness Trackers:</h3>
        
        <!-- Fitbit Connection -->
        <div style="display: inline-flex; align-items: center; gap: 0.5rem; margin-right: 1rem; margin-bottom: 0.5rem;">
            {% if not current_user.fitbit_connected %}
            <form method="POST" action="{{ url_for('integrations.connect_fitbit') }}" style="display: inline;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <button type="submit" class="btn btn-primary">Connect Fitbit</button>
            </form>
            {% else %}
            <button class="btn btn-primary" disabled>✓ Fitbit Connected</button>
            <form method="POST" action="{{ url_for('integrations.disconnect_fitbit') }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to disconnect Fitbit?');">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <button type="submit" class="btn" style="background: #dc3545; color: white;">Disconnect</button>
            </form>
            {% endif %}
        </div>
        
        <!-- Oura Connection -->
        <div style="display: inline-flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
            {% if not current_user.oura_connected %}
            <form method="POST" action="{{ url_for('integrations.connect_oura') }}" style="display: inline;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <button type="submit" class="btn btn-primary">Connect Oura</button>
            </form>
            {% else %}
            <button class="btn btn-primary" disabled>✓ Oura Connected</button>
            <form method="POST" action="{{ url_for('integrations.disconnect_oura') }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to disconnect Oura?');">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <button type="submit" class="btn" style="background: #dc3545; color: white;">Disconnect</button>
            </form>
            {% endif %}
        </div>
    </div>
    
    <!-- Manual Fitness Score Input -->
    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e0e0e0;">
        <h3 style="font-size: 0.95rem; margin-bottom: 0.5rem; color: #555;">Manual Fitness Scores 
            {% if current_user.manual_score_date %}
            <span style="font-weight: normal; font-size: 0.85rem; color: #27ae60;">(Updated: {{ current_user.manual_score_date.strftime('%b %d') }})</span>
            {% endif %}
        </h3>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; padding: 0.75rem; background: #f8f9fa; border-radius: 4px;">
            <div>
                <label for="manual_sleep_score" style="font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">Sleep <span id="sleep_score_value" style="font-weight: bold; color: #2c3e50;">{{ current_user.manual_sleep_score or 50 }}</span></label>
                <input type="range" id="manual_sleep_score" name="manual_sleep_score" 
                       min="0" max="100" value="{{ current_user.manual_sleep_score or 50 }}"
                       style="width: 100%;">
            </div>
            
            <div>
                <label for="manual_readiness_score" style="font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">Readiness <span id="readiness_score_value" style="font-weight: bold; color: #2c3e50;">{{ current_user.manual_readiness_score or 50 }}</span></label>
                <input type="range" id="manual_readiness_score" name="manual_readiness_score" 
                       min="0" max="100" value="{{ current_user.manual_readiness_score or 50 }}"
                       style="width: 100%;">
            </div>
        </div>
        
        <button id="save_manual_scores" class="btn btn-success" style="margin-top: 0.5rem; padding: 0.4rem 0.8rem; font-size: 0.9rem;">
            Save Scores
        </button>
        <div id="manual_scores_message" style="margin-top: 0.25rem; font-size: 0.85rem;"></div>
    </div>
</div>

<div class="card">
    <h2>Add New Activity</h2>
    <form method="POST" action="{{ url_for('activities.add_activity') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <div class="form-group">
            <label for="name">Activity Name *</label>
            <input type="text" id="name" name="name" required placeholder="e.g., Morning Run, Yoga, Swimming">
        </div>
        
        <div class="form-group">
            <label for="location">Location</label>
            <input type="text" id="location" name="location" placeholder="e.g., Local Park, Gym, Home">
        </div>
        
        <div class="form-group">
            <label for="duration">Duration</label>
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 0.5rem;">
                <input type="number" id="duration" name="duration" min="1" placeholder="e.g., 30 or 1.5">
                <select id="duration_unit" name="duration_unit">
                    <option value="minutes">Minutes</option>
                    <option value="hours">Hours</option>
                </select>
            </div>
        </div>
        
        <div class="form-group">
            <label for="intensity">Intensity Level</label>
            <select id="intensity" name="intensity">
                <option value="">Select intensity</option>
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
                <option value="Very High">Very High</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="dependencies">Dependencies</label>
            <input type="text" id="dependencies" name="dependencies" placeholder="e.g., Good weather, Equipment needed">
        </div>
        
        <div class="form-group">
            <label for="preferred_time">Preferred Time of Day</label>
            <select id="preferred_time" name="preferred_time">
                <option value="">No preference</option>
                <option value="Morning">Morning (6 AM - 12 PM)</option>
                <option value="Afternoon">Afternoon (12 PM - 5 PM)</option>
                <option value="Evening">Evening (5 PM - 9 PM)</option>
                <option value="Night">Night (9 PM - 12 AM)</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="preferred_days">Preferred Days of Week</label>
            <div style="display: flex; flex-wrap: wrap; gap: 1.5rem; margin-top: 0.5rem;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="preferred_days" value="Monday" style="width: auto; margin-right: 0.5rem;">
                    <span>Monday</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="preferred_days" value="Tuesday" style="width: auto; margin-right: 0.5rem;">
                    <span>Tuesday</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="preferred_days" value="Wednesday" style="width: auto; margin-right: 0.5rem;">
                    <span>Wednesday</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="preferred_days" value="Thursday" style="width: auto; margin-right: 0.5rem;">
                    <span>Thursday</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="preferred_days" value="Friday" style="width: auto; margin-right: 0.5rem;">
                    <span>Friday</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="preferred_days" value="Saturday" style="width: auto; margin-right: 0.5rem;">
                    <span>Saturday</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="preferred_days" value="Sunday" style="width: auto; margin-right: 0.5rem;">
                    <span>Sunday</span>
                </label>
            </div>
        </div>
        
        <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" name="description" placeholder="Additional notes about this activity..."></textarea>
        </div>
        
        <button type="submit" class="btn btn-success">Add Activity</button>
    </form>
</div>

<div class="card">
    <h2>Your Activities</h2>
    {% if activities %}
        <div style="display: grid; gap: 1rem; margin-top: 1rem;">
            {% for activity in activities %}
                <div style="border: 1px solid #ddd; padding: 1rem; border-radius: 4px;">
                    <h3 style="margin-bottom: 0.5rem;">{{ activity.name }}</h3>
                    {% if activity.location %}
                        <p><strong>Location:</strong> {{ activity.location }}</p>
                    {% endif %}
                    {% if activity.duration_minutes %}
                        <p><strong>Duration:</strong> {{ activity.duration_minutes }} minutes</p>
                    {% endif %}
                    {% if activity.intensity %}
                        <p><strong>Intensity:</strong> {{ activity.intensity }}</p>
                    {% endif %}
                    {% if activity.dependencies %}
                        <p><strong>Dependencies:</strong> {{ activity.dependencies }}</p>
                    {% endif %}
                    {% if activity.preferred_time %}
                        <p><strong>Preferred Time:</strong> {{ activity.preferred_time }}</p>
                    {% endif %}
                    {% if activity.preferred_days %}
                        <p><strong>Preferred Days:</strong> {{ activity.preferred_days }}</p>
                    {% endif %}
                    {% if activity.description %}
                        <p><strong>Description:</strong> {{ activity.description }}</p>
                    {% endif %}
                    <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                        <button type="button" class="btn btn-primary" 
                                data-activity-id="{{ activity.id }}"
                                data-activity-name="{{ activity.name }}"
                                data-activity-location="{{ activity.location or '' }}"
                                data-activity-duration="{{ activity.duration_minutes or 0 }}"
                                data-activity-intensity="{{ activity.intensity or '' }}"
                                data-activity-dependencies="{{ activity.dependencies or '' }}"
                                data-activity-description="{{ activity.description or '' }}"
                                data-activity-preferred-time="{{ activity.preferred_time or '' }}"
                                data-activity-preferred-days="{{ activity.preferred_days or '' }}"
                                onclick="openEditActivityModal(this)">Edit</button>
                        <form method="POST" action="{{ url_for('activities.delete_activity', activity_id=activity.id) }}" style="display: inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                            <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this activity?')">Delete</button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p style="margin-top: 1rem; color: #666;">No activities logged yet. Add your first activity above!</p>
    {% endif %}
</div>

<div class="card">
    <h2>Add Appointment/Responsibility</h2>
    <form method="POST" action="{{ url_for('activities.add_appointment') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <div class="form-group">
            <label for="title">Title *</label>
            <input type="text" id="title" name="title" required placeholder="e.g., Doctor Appointment, Work Meeting, School">
        </div>
        
        <div class="form-group">
            <label for="appointment_type">Type</label>
            <select id="appointment_type" name="appointment_type">
                <option value="Work">Work</option>
                <option value="School">School</option>
                <option value="Doctor">Doctor/Medical</option>
                <option value="Plans">Plans/Social</option>
                <option value="Other">Other</option>
            </select>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div class="form-group">
                <label for="date">Date *</label>
                <input type="date" id="date" name="date" required>
            </div>
            
            <div class="form-group">
                <label for="time">Time (optional)</label>
                <input type="time" id="time" name="time">
            </div>
        </div>
        
        <div class="form-group">
            <label for="appointment_duration">Duration (optional)</label>
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 0.5rem;">
                <input type="number" id="appointment_duration" name="duration_minutes" min="1" placeholder="e.g., 30 or 1.5">
                <select id="appointment_duration_unit" name="duration_unit">
                    <option value="minutes">Minutes</option>
                    <option value="hours">Hours</option>
                </select>
            </div>
        </div>
        
        <div class="form-group">
            <label>Repeating Days (optional)</label>
            <div style="margin-bottom: 0.75rem;">
                <button type="button" class="btn btn-primary" style="padding: 0.4rem 0.8rem; font-size: 0.9rem; margin-right: 0.5rem;" onclick="selectAppointmentDays('all')">All Days</button>
                <button type="button" class="btn btn-primary" style="padding: 0.4rem 0.8rem; font-size: 0.9rem; margin-right: 0.5rem;" onclick="selectAppointmentDays('weekdays')">Weekdays</button>
                <button type="button" class="btn btn-primary" style="padding: 0.4rem 0.8rem; font-size: 0.9rem; margin-right: 0.5rem;" onclick="selectAppointmentDays('weekends')">Weekends</button>
                <button type="button" class="btn btn-danger" style="padding: 0.4rem 0.8rem; font-size: 0.9rem;" onclick="selectAppointmentDays('none')">Clear</button>
            </div>
            <div style="display: flex; flex-wrap: wrap; gap: 1.5rem;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="repeating_days" value="Monday" class="appointment-day-checkbox" style="width: auto; margin-right: 0.5rem;">
                    <span>Monday</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="repeating_days" value="Tuesday" class="appointment-day-checkbox" style="width: auto; margin-right: 0.5rem;">
                    <span>Tuesday</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="repeating_days" value="Wednesday" class="appointment-day-checkbox" style="width: auto; margin-right: 0.5rem;">
                    <span>Wednesday</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="repeating_days" value="Thursday" class="appointment-day-checkbox" style="width: auto; margin-right: 0.5rem;">
                    <span>Thursday</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="repeating_days" value="Friday" class="appointment-day-checkbox" style="width: auto; margin-right: 0.5rem;">
                    <span>Friday</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="repeating_days" value="Saturday" class="appointment-day-checkbox" style="width: auto; margin-right: 0.5rem;">
                    <span>Saturday</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="repeating_days" value="Sunday" class="appointment-day-checkbox" style="width: auto; margin-right: 0.5rem;">
                    <span>Sunday</span>
                </label>
            </div>
        </div>
        
        <div class="form-group">
            <label for="appointment_description">Description</label>
            <textarea id="appointment_description" name="description" placeholder="Additional details..."></textarea>
        </div>
        
        <button type="submit" class="btn btn-success">Add Appointment</button>
    </form>
</div>

<div class="card">
    <h2>Your Appointments & Responsibilities</h2>
    {% if appointments %}
        <div style="display: grid; gap: 1rem; margin-top: 1rem;">
            {% for appointment in appointments %}
                <div style="border: 1px solid #ddd; padding: 1rem; border-radius: 4px; background: {% if appointment.appointment_type == 'Work' %}#fff3cd{% elif appointment.appointment_type == 'School' %}#d1ecf1{% elif appointment.appointment_type == 'Doctor' %}#f8d7da{% elif appointment.appointment_type == 'Plans' %}#d4edda{% else %}#f8f9fa{% endif %};">
                    <h3 style="margin-bottom: 0.5rem;">{{ appointment.title }}</h3>
                    <p><strong>Type:</strong> {{ appointment.appointment_type }}</p>
                    <p><strong>Date:</strong> {{ appointment.date.strftime('%A, %B %d, %Y') }}</p>
                    {% if appointment.time %}
                        <p><strong>Time:</strong> {{ appointment.time.strftime('%I:%M %p') }}</p>
                    {% endif %}
                    {% if appointment.duration_minutes %}
                        <p><strong>Duration:</strong> {{ appointment.duration_minutes }} minutes</p>
                    {% endif %}
                    {% if appointment.repeating_days %}
                        <p><strong>Repeats on:</strong> {{ appointment.repeating_days }}</p>
                    {% endif %}
                    {% if appointment.description %}
                        <p><strong>Description:</strong> {{ appointment.description }}</p>
                    {% endif %}
                    <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                        <button type="button" class="btn btn-primary"
                                data-appointment-id="{{ appointment.id }}"
                                data-appointment-title="{{ appointment.title }}"
                                data-appointment-type="{{ appointment.appointment_type }}"
                                data-appointment-date="{{ appointment.date.strftime('%Y-%m-%d') }}"
                                data-appointment-time="{{ appointment.time.strftime('%H:%M') if appointment.time else '' }}"
                                data-appointment-duration="{{ appointment.duration_minutes or 0 }}"
                                data-appointment-description="{{ appointment.description or '' }}"
                                data-appointment-repeating-days="{{ appointment.repeating_days or '' }}"
                                onclick="openEditAppointmentModal(this)">Edit</button>
                        <form method="POST" action="{{ url_for('activities.delete_appointment', appointment_id=appointment.id) }}" style="display: inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                            <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this appointment?')">Delete</button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p style="margin-top: 1rem; color: #666;">No appointments scheduled yet. Add your first appointment above!</p>
    {% endif %}
</div>

<!-- Edit Activity Modal -->
<div id="editActivityModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto;">
    <div style="background: white; margin: 2rem auto; padding: 2rem; max-width: 600px; border-radius: 8px;">
        <h2>Edit Activity</h2>
        <form id="editActivityForm" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="form-group">
                <label>Activity Name *</label>
                <input type="text" name="name" id="edit_activity_name" required>
            </div>
            <div class="form-group">
                <label>Location</label>
                <input type="text" name="location" id="edit_activity_location">
            </div>
            <div class="form-group">
                <label>Duration</label>
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 0.5rem;">
                    <input type="number" name="duration" id="edit_activity_duration" min="1">
                    <select name="duration_unit" id="edit_activity_duration_unit">
                        <option value="minutes">Minutes</option>
                        <option value="hours">Hours</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Intensity</label>
                <select name="intensity" id="edit_activity_intensity">
                    <option value="">Select intensity</option>
                    <option value="Low">Low</option>
                    <option value="Medium">Medium</option>
                    <option value="High">High</option>
                    <option value="Very High">Very High</option>
                </select>
            </div>
            <div class="form-group">
                <label>Dependencies</label>
                <input type="text" name="dependencies" id="edit_activity_dependencies">
            </div>
            <div class="form-group">
                <label>Preferred Time</label>
                <select name="preferred_time" id="edit_activity_preferred_time">
                    <option value="">No preference</option>
                    <option value="Morning">Morning</option>
                    <option value="Afternoon">Afternoon</option>
                    <option value="Evening">Evening</option>
                    <option value="Night">Night</option>
                </select>
            </div>
            <div class="form-group">
                <label>Preferred Days</label>
                <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
                    <label style="display: flex; align-items: center;"><input type="checkbox" name="preferred_days" value="Monday" class="edit-activity-day" style="width: auto; margin-right: 0.5rem;">Monday</label>
                    <label style="display: flex; align-items: center;"><input type="checkbox" name="preferred_days" value="Tuesday" class="edit-activity-day" style="width: auto; margin-right: 0.5rem;">Tuesday</label>
                    <label style="display: flex; align-items: center;"><input type="checkbox" name="preferred_days" value="Wednesday" class="edit-activity-day" style="width: auto; margin-right: 0.5rem;">Wednesday</label>
                    <label style="display: flex; align-items: center;"><input type="checkbox" name="preferred_days" value="Thursday" class="edit-activity-day" style="width: auto; margin-right: 0.5rem;">Thursday</label>
                    <label style="display: flex; align-items: center;"><input type="checkbox" name="preferred_days" value="Friday" class="edit-activity-day" style="width: auto; margin-right: 0.5rem;">Friday</label>
                    <label style="display: flex; align-items: center;"><input type="checkbox" name="preferred_days" value="Saturday" class="edit-activity-day" style="width: auto; margin-right: 0.5rem;">Saturday</label>
                    <label style="display: flex; align-items: center;"><input type="checkbox" name="preferred_days" value="Sunday" class="edit-activity-day" style="width: auto; margin-right: 0.5rem;">Sunday</label>
                </div>
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea name="description" id="edit_activity_description"></textarea>
            </div>
            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                <button type="submit" class="btn btn-success">Save Changes</button>
                <button type="button" class="btn" onclick="closeEditActivityModal()">Cancel</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Appointment Modal -->
<div id="editAppointmentModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto;">
    <div style="background: white; margin: 2rem auto; padding: 2rem; max-width: 600px; border-radius: 8px;">
        <h2>Edit Appointment</h2>
        <form id="editAppointmentForm" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="form-group">
                <label>Title *</label>
                <input type="text" name="title" id="edit_appointment_title" required>
            </div>
            <div class="form-group">
                <label>Type</label>
                <select name="appointment_type" id="edit_appointment_type">
                    <option value="Work">Work</option>
                    <option value="School">School</option>
                    <option value="Doctor">Doctor/Medical</option>
                    <option value="Plans">Plans/Social</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label>Date *</label>
                    <input type="date" name="date" id="edit_appointment_date" required>
                </div>
                <div class="form-group">
                    <label>Time</label>
                    <input type="time" name="time" id="edit_appointment_time">
                </div>
            </div>
            <div class="form-group">
                <label>Duration</label>
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 0.5rem;">
                    <input type="number" name="duration_minutes" id="edit_appointment_duration" min="1">
                    <select name="duration_unit" id="edit_appointment_duration_unit">
                        <option value="minutes">Minutes</option>
                        <option value="hours">Hours</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Repeating Days</label>
                <div style="margin-bottom: 0.75rem;">
                    <button type="button" class="btn btn-primary" style="padding: 0.4rem 0.8rem; font-size: 0.9rem; margin-right: 0.5rem;" onclick="selectEditAppointmentDays('all')">All Days</button>
                    <button type="button" class="btn btn-primary" style="padding: 0.4rem 0.8rem; font-size: 0.9rem; margin-right: 0.5rem;" onclick="selectEditAppointmentDays('weekdays')">Weekdays</button>
                    <button type="button" class="btn btn-primary" style="padding: 0.4rem 0.8rem; font-size: 0.9rem; margin-right: 0.5rem;" onclick="selectEditAppointmentDays('weekends')">Weekends</button>
                    <button type="button" class="btn btn-danger" style="padding: 0.4rem 0.8rem; font-size: 0.9rem;" onclick="selectEditAppointmentDays('none')">Clear</button>
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
                    <label style="display: flex; align-items: center;"><input type="checkbox" name="repeating_days" value="Monday" class="edit-appointment-day" style="width: auto; margin-right: 0.5rem;">Monday</label>
                    <label style="display: flex; align-items: center;"><input type="checkbox" name="repeating_days" value="Tuesday" class="edit-appointment-day" style="width: auto; margin-right: 0.5rem;">Tuesday</label>
                    <label style="display: flex; align-items: center;"><input type="checkbox" name="repeating_days" value="Wednesday" class="edit-appointment-day" style="width: auto; margin-right: 0.5rem;">Wednesday</label>
                    <label style="display: flex; align-items: center;"><input type="checkbox" name="repeating_days" value="Thursday" class="edit-appointment-day" style="width: auto; margin-right: 0.5rem;">Thursday</label>
                    <label style="display: flex; align-items: center;"><input type="checkbox" name="repeating_days" value="Friday" class="edit-appointment-day" style="width: auto; margin-right: 0.5rem;">Friday</label>
                    <label style="display: flex; align-items: center;"><input type="checkbox" name="repeating_days" value="Saturday" class="edit-appointment-day" style="width: auto; margin-right: 0.5rem;">Saturday</label>
                    <label style="display: flex; align-items: center;"><input type="checkbox" name="repeating_days" value="Sunday" class="edit-appointment-day" style="width: auto; margin-right: 0.5rem;">Sunday</label>
                </div>
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea name="description" id="edit_appointment_description"></textarea>
            </div>
            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                <button type="submit" class="btn btn-success">Save Changes</button>
                <button type="button" class="btn" onclick="closeEditAppointmentModal()">Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
function selectAppointmentDays(selection) {
    const checkboxes = document.querySelectorAll('.appointment-day-checkbox');
    const weekdays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
    const weekends = ['Saturday', 'Sunday'];
    
    checkboxes.forEach(checkbox => {
        const day = checkbox.value;
        
        if (selection === 'all') {
            checkbox.checked = true;
        } else if (selection === 'weekdays') {
            checkbox.checked = weekdays.includes(day);
        } else if (selection === 'weekends') {
            checkbox.checked = weekends.includes(day);
        } else if (selection === 'none') {
            checkbox.checked = false;
        }
    });
}

function openEditActivityModal(button) {
    const id = button.dataset.activityId;
    const name = button.dataset.activityName;
    const location = button.dataset.activityLocation;
    const duration = parseInt(button.dataset.activityDuration) || 0;
    const intensity = button.dataset.activityIntensity;
    const dependencies = button.dataset.activityDependencies;
    const description = button.dataset.activityDescription;
    const preferredTime = button.dataset.activityPreferredTime;
    const preferredDays = button.dataset.activityPreferredDays;
    
    document.getElementById('editActivityForm').action = `/edit_activity/${id}`;
    document.getElementById('edit_activity_name').value = name;
    document.getElementById('edit_activity_location').value = location;
    
    // Set duration (convert from minutes)
    if (duration > 0) {
        if (duration >= 60 && duration % 60 === 0) {
            document.getElementById('edit_activity_duration').value = duration / 60;
            document.getElementById('edit_activity_duration_unit').value = 'hours';
        } else {
            document.getElementById('edit_activity_duration').value = duration;
            document.getElementById('edit_activity_duration_unit').value = 'minutes';
        }
    } else {
        document.getElementById('edit_activity_duration').value = '';
    }
    
    document.getElementById('edit_activity_intensity').value = intensity;
    document.getElementById('edit_activity_dependencies').value = dependencies;
    document.getElementById('edit_activity_preferred_time').value = preferredTime;
    document.getElementById('edit_activity_description').value = description;
    
    // Set preferred days checkboxes
    const dayCheckboxes = document.querySelectorAll('.edit-activity-day');
    const selectedDays = preferredDays.split(',').map(d => d.trim());
    dayCheckboxes.forEach(cb => {
        cb.checked = selectedDays.includes(cb.value);
    });
    
    document.getElementById('editActivityModal').style.display = 'block';
}

function closeEditActivityModal() {
    document.getElementById('editActivityModal').style.display = 'none';
}

function openEditAppointmentModal(button) {
    const id = button.dataset.appointmentId;
    const title = button.dataset.appointmentTitle;
    const type = button.dataset.appointmentType;
    const date = button.dataset.appointmentDate;
    const time = button.dataset.appointmentTime;
    const duration = parseInt(button.dataset.appointmentDuration) || 0;
    const description = button.dataset.appointmentDescription;
    const repeatingDays = button.dataset.appointmentRepeatingDays;
    
    document.getElementById('editAppointmentForm').action = `/edit_appointment/${id}`;
    document.getElementById('edit_appointment_title').value = title;
    document.getElementById('edit_appointment_type').value = type;
    document.getElementById('edit_appointment_date').value = date;
    document.getElementById('edit_appointment_time').value = time;
    
    // Set duration (convert from minutes)
    if (duration > 0) {
        if (duration >= 60 && duration % 60 === 0) {
            document.getElementById('edit_appointment_duration').value = duration / 60;
            document.getElementById('edit_appointment_duration_unit').value = 'hours';
        } else {
            document.getElementById('edit_appointment_duration').value = duration;
            document.getElementById('edit_appointment_duration_unit').value = 'minutes';
        }
    } else {
        document.getElementById('edit_appointment_duration').value = '';
    }
    
    document.getElementById('edit_appointment_description').value = description;
    
    // Set repeating days checkboxes
    const dayCheckboxes = document.querySelectorAll('.edit-appointment-day');
    const selectedDays = repeatingDays.split(',').map(d => d.trim());
    dayCheckboxes.forEach(cb => {
        cb.checked = selectedDays.includes(cb.value);
    });
    
    document.getElementById('editAppointmentModal').style.display = 'block';
}

function closeEditAppointmentModal() {
    document.getElementById('editAppointmentModal').style.display = 'none';
}

function selectEditAppointmentDays(selection) {
    const checkboxes = document.querySelectorAll('.edit-appointment-day');
    const weekdays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
    const weekends = ['Saturday', 'Sunday'];
    
    checkboxes.forEach(checkbox => {
        const day = checkbox.value;
        
        if (selection === 'all') {
            checkbox.checked = true;
        } else if (selection === 'weekdays') {
            checkbox.checked = weekdays.includes(day);
        } else if (selection === 'weekends') {
            checkbox.checked = weekends.includes(day);
        } else if (selection === 'none') {
            checkbox.checked = false;
        }
    });
}

// Close modals when clicking outside
window.onclick = function(event) {
    if (event.target == document.getElementById('editActivityModal')) {
        closeEditActivityModal();
    }
    if (event.target == document.getElementById('editAppointmentModal')) {
        closeEditAppointmentModal();
    }
}

// Manual fitness scores functionality
document.getElementById('manual_sleep_score').addEventListener('input', function(e) {
    document.getElementById('sleep_score_value').textContent = e.target.value;
});

document.getElementById('manual_readiness_score').addEventListener('input', function(e) {
    document.getElementById('readiness_score_value').textContent = e.target.value;
});

document.getElementById('save_manual_scores').addEventListener('click', function() {
    const sleepScore = parseInt(document.getElementById('manual_sleep_score').value);
    const readinessScore = parseInt(document.getElementById('manual_readiness_score').value);
    const messageDiv = document.getElementById('manual_scores_message');
    
    fetch('/update_manual_scores', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            sleep_score: sleepScore,
            readiness_score: readinessScore
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            messageDiv.innerHTML = '<span style="color: #27ae60;">✓ Scores saved successfully!</span>';
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 3000);
        } else {
            messageDiv.innerHTML = '<span style="color: #e74c3c;">Error: ' + data.error + '</span>';
        }
    })
    .catch(error => {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">Error saving scores</span>';
    });
});
</script>
{% endblock %}
